---
date: 2017-04-17
title: "PHP 中的 Trait"
tags:
    - PHP
categories:
    - PHP
gitment: true
---

1. Trait是神马

	Trait是PHP5.4.0中加入的语言特性,是一种代码复用机制,为了解决类的单继承导致的一些局限性问题.可以简单理解为一种多重继承的一种替代方案.
2. Trait和类的继承有何区别

	Trait和类相似, 但仅仅旨在用细粒度和一致的方式来组合功能, Trait无法实例化成具体的对象,如果将传统类的继承理解为纵向的代码复用与拓展,那么trait就提供了横向代码复用的能力.3. Trait的具体使用

	* 什么时候可以使用trait?

	理论上凡是需要或将要使用继承的地方都可以考虑使用trait来实现,其次当有两个完全无关的类(无继承关系,各自有自己独立的父类),但是这两个类有需要编写相同的逻辑实现时,就可以考虑使用trait来拓展类的功能

	* Trait的使用方式

	Trait官方示例:    ![官方示例](http://oojbdbtdp.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-17%2015.29.26.png)
	* Trait和类继承同时使用时的覆盖问题

	从基类继承的成员会被 trait 插入的成员所覆盖。优先顺序是来自当前类的成员覆盖了 trait 的方法，而 trait 则覆盖了被继承的方法。
	优先级顺序:
	* 子类override的父类方法 > trait方法 > 子类继承自父类的方法
	
	* 当前类的成员方法 > trait方法

	* 多个Trait同时使用

	和implement接口类似,在use引入trait时,允许同时引入多个trait,并使用逗号隔开.	* trait冲突

	当一个类引入了多个trait,且这些trait中都定义了相同名称的方法,此时就会出现trait冲突,如果逻辑中没有编写对应的处理,则会抛出异常中断执行.当发生trait冲突时,需要使用 insteadof 操作符来明确指定使用冲突方法中的哪一个。以上方式仅允许排除掉其它方法，as 操作符可以将其中一个冲突的方法以另一个名称来引入。
	例如:    ![](http://oojbdbtdp.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-17%2015.32.12.png)

    ![](http://oojbdbtdp.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-04-17%2015.32.20.png)

	* trait的组合

	trait支持组合使用,也就是在一个trait中可以引入另一个或多个 trait来组合成一个新的trait,通过把逻辑实现的最小单元化,理论上可以用不同的trait排列组合,整合出无穷多的新trait,从而取代传统类的继承都不在话下.	* trait中的抽象成员

	trait中也允许定义抽象成员方法,当有其他类引用该trait时必须对其中的抽象方法编写实现,类似于抽象类和接口的使用

	* trait中可以定义静态方法

	* trait中的属性定义

	trait中可以定义属性,如果引入trait的类和trait中定义的属性存在冲突,则会抛出异常,但是,如果类中定义的属性和trait中定义的属性兼容(相同的访问修饰符和初始值)则类中的属性会覆盖trait中的,否则抛出异常.
4. 总结

	Trait特性可以说从根本上解决了单继承语言代码横向复用的大问题,利用trait的自由任意组合的机制,理论上都可以吧类的继承完全替代掉.但是trait使用时需要注意的问题点也比较多,尤其是成员方法的命名冲突,因为PHP是没有方法重载的,所以这个问题会变得尤其突出,所以在我们日常使用的时候需要特别小心.
	现如今主流的PHP框架中都或多或少的引入了trait特性来实现一些意想不到的功能,比如yii的ORM组件就大量的使用了trait来组合通用的数据库查询实现: